<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: view/Simulator.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: view/Simulator.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as THREE from "three";
import Resources from "../model/Utils/Resources/Resources";
import Sizes from "../model/Utils/Sizes";
import Time from "../model/Utils/Time";
import Renderer from "./Renderer";
import World from "./World";
import Sources from "../model/Utils/Resources/Sources";
import { Events } from "../controller/Utils/Events";
import Camera from "./Camera";
import Environment from "../model/Environment";
import Physics from "../controller/Physics";
import Submarines from "../model/Submarines";
import GUI from 'lil-gui';
import SubmarineView from '../view/SubmarineView';
/**
 * Simulator class for managing the WebGL-based simulation environment.
 *
 * This class integrates components for scene rendering, resource management,
 * time handling, debugging, and world simulation.
 *
 * @class
 */
class Simulator {
  /**
   * Creates an instance of the Simulator class.
   * Initializes all necessary components and sets up event listeners.
   *
   * @param {HTMLCanvasElement} canvas - The HTML canvas element for rendering.
   * @constructor
   */
  constructor(canvas) {
    /**
     * Singleton instance of the Simulator class.
     *
     * @type {Simulator}
     * @private
     */
    this.instance = null;
    // Singleton pattern
    if (this.instance) {
      return this.instance;
    }
    this.instance = this;
    // Set canvas
    this.canvas = canvas;
    // Initialize components
    this.sizes = new Sizes();
    this.time = new Time();
    this.scene = new THREE.Scene();
    this.resources = new Resources(Sources);
    this.camera = new Camera(this);
    this.renderer = new Renderer(this);
    this.world = new World(this);
    this.environment = new Environment(9.8, 1025);
    this.submarines = new Submarines();
    this.physics = new Physics(this);
    this.time.on(Events.ClockTick, () => this.physics.simulateStep());
    // Subscribe to resize event
    this.sizes.on(Events.Resize, () => this.resize());
    // Subscribe to frame tick event
    this.time.on(Events.FrameTick, () => this.update());

    // Setup the loading screen with lil-gui
    this.setupLoadingScreen();

    // Listen for resource loading events
    this.resources.on(Events.ResourceProgress, () => {
      this.gui.controllers[0].setValue(this.resources.progress * 100);
    });

    this.resources.on(Events.ResourcesReady, () => {
      // Remove or hide the loading screen once resources are ready
      this.gui.destroy();
    });
  }
  setupLoadingScreen() {
    // Initialize lil-gui
    this.gui = new GUI({ title: 'Loading...', autoPlace: false });

    document.body.appendChild(this.gui.domElement);

    // Apply custom CSS class for better styling
    this.gui.domElement.classList.add('loading');

    // Use a number display instead of a slider
    this.progressController = this.gui.add({ Progress: 0 }, 'Progress', 0, 100).step(1).listen().disable();

  }
  /**
   * Handles resize event by updating camera and renderer dimensions.
   *
   * @public
   */
  resize() {
    this.camera.resize();
    this.renderer.resize();
  }
  /**
   * Updates the simulation state on each frame tick.
   *
   * @public
   */
  update() {
    this.camera.update();
    this.world.update();
    this.renderer.update();
  }
  /**
   * Destroys the simulator instance and cleans up resources.
   *
   * This method unsubscribes from events, disposes resources, and clears scene objects.
   *
   * @public
   */
  destroy() {
    // Unsubscribe from events
    this.sizes.off(Events.Resize);
    this.time.off(Events.FrameTick);
    this.time.off(Events.ClockTick);
    this.time.off(Events.ResourcesReady);
    // Traverse scene and dispose objects
    this.scene.traverse((child) => {
      if (child instanceof THREE.Mesh) {
        child.geometry.dispose();
        for (const key in child.material) {
          const value = child.material[key];
          if (value &amp;&amp; typeof value.dispose === "function") {
            value.dispose();
          }
        }
      }
    });
    // Dispose camera, renderer, and debug
    this.camera.dispose();
    this.renderer.dispose();
    if (this.controlGUI.active) {
      this.controlGUI.dispose();
    }
  }
}
export default Simulator;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Camera.html">Camera</a></li><li><a href="Debug.html">Debug</a></li><li><a href="Environment.html">Environment</a></li><li><a href="EventEmitter.html">EventEmitter</a></li><li><a href="Phyiscs.html">Phyiscs</a></li><li><a href="Renderer.html">Renderer</a></li><li><a href="Resources.html">Resources</a></li><li><a href="SceneEnvironment.html">SceneEnvironment</a></li><li><a href="Simulator.html">Simulator</a></li><li><a href="Sizes.html">Sizes</a></li><li><a href="Source.html">Source</a></li><li><a href="Subamrines.html">Subamrines</a></li><li><a href="Submarine.html">Submarine</a></li><li><a href="SubmarineConstants.html">SubmarineConstants</a></li><li><a href="SubmarineDebug.html">SubmarineDebug</a></li><li><a href="SubmarineState.html">SubmarineState</a></li><li><a href="SubmarineView.html">SubmarineView</a></li><li><a href="Time.html">Time</a></li><li><a href="World.html">World</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Events">Events</a></li><li><a href="global.html#ResourceNames">ResourceNames</a></li><li><a href="global.html#ResourceTypes">ResourceTypes</a></li><li><a href="global.html#SubmarineType">SubmarineType</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Wed Oct 09 2024 16:23:08 GMT+0300 (GMT+03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
